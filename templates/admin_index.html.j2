<!doctype html>
<html>
<head>
  <title>Admin Menu</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <h1>Admin Menu</h1>

  <div class="center" style="margin-bottom:12px;">
    <a href="{{ url_for('admin.admin_questions') }}" class="button">Manage Questions</a>
    <a href="{{ url_for('admin.progress') }}" class="button">Progress</a>
    <a href="{{ url_for('admin.admin_download_questions') }}" class="button" download="riddles.json">Download JSON</a>
  </div>

  <h2>Upload new game (JSON)</h2>
  <p>Choose a riddles JSON file to replace the current game. The file will overwrite the configured config file.</p>

  <!-- Upload form: single button opens file dialog then auto-submits -->
  <form id="upload-form" action="{{ url_for('admin_upload') }}" method="post" enctype="multipart/form-data" style="margin-bottom:12px;">
    <input id="game-file-input" type="file" name="file" accept=".json,application/json" style="display:none;">
    <label for="game-file-input" class="button" style="cursor:pointer; margin-right:8px;">Choose and Upload</label>
    <span id="selected-filename" style="margin-left:8px;">No file chosen</span>
  </form>

  <script>
    (function(){
      const input = document.getElementById('game-file-input');
      const form = document.getElementById('upload-form');
      const filenameSpan = document.getElementById('selected-filename');
      if (!input || !form) return;
      input.addEventListener('change', function(){
        const name = input.files && input.files.length ? input.files[0].name : 'No file chosen';
        filenameSpan.textContent = name;
        if (input.files && input.files.length) {
          // auto-submit when a file is chosen
          form.submit();
        }
      });
    })();
  </script>

  <div style="margin-top:18px;">
    <a href="{{ url_for('admin_questions') }}" class="button">Back to Questions</a>
  </div>
</body>
</html>